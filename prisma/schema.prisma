generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/universo_hogara/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Product {
  id          String      @id @default(cuid())
  name        String
  description String
  price       Float
  category    String
  stock       Int
  variations  String?
  image_url   String?
  slug        String      @unique
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt
  order_items OrderItem[]

  @@map("products")
}

model Order {
  id            String      @id @default(cuid())
  customer_name String
  email         String
  phone         String?
  address       String
  city          String?
  postal_code   String?
  total         Float
  status        String      @default("pending")
  payment_id    String?
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt
  order_items   OrderItem[]

  @@map("orders")
}

model OrderItem {
  id         String  @id @default(cuid())
  order_id   String
  product_id String
  quantity   Int
  price      Float
  variation  String?
  order      Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product    Product @relation(fields: [product_id], references: [id])

  @@map("order_items")
}

model Contact {
  id         String   @id @default(cuid())
  name       String
  email      String
  subject    String?
  message    String
  status     String   @default("new")
  created_at DateTime @default(now())

  @@map("contacts")
}

model BlogPost {
  id               String   @id @default(cuid())
  title            String
  content          String
  excerpt          String?
  image_url        String?
  slug             String   @unique
  published        Boolean  @default(true)
  meta_description String?
  category         String   // hogara-planner, hogara-pet, hogara-mind, hogara-home, hogara-luz, hogara-esencia, hogara-app
  author_name      String   @default("Universo Hogara")
  tags             String?  // Comma-separated tags
  featured         Boolean  @default(false)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  @@map("blog_posts")
  @@index([category])
  @@index([published])
}

model User {
  id                    String                  @id @default(cuid())
  name                  String?
  email                 String                  @unique
  emailVerified         DateTime?
  image                 String?
  role                  String                  @default("user")
  created_at            DateTime                @default(now())
  password              String?
  updated_at            DateTime?               @updatedAt
  experience            Int                     @default(0)
  level                 Int                     @default(1)
  points                Int                     @default(0)
  voice_minutes_used    Int                     @default(0)
  voice_minutes_limit   Int                     @default(100)
  voice_reset_date      DateTime?               @default(now())
  voice_last_used       DateTime?
  elevenLabsApiKey      String?
  accounts              Account[]
  chat_messages         ChatMessage[]
  community_posts       CommunityPost[]
  companions            Companion[]
  dream_entries         dream_entries[]
  exercise_entries      exercise_entries[]
  finance_entries       finance_entries[]
  gratitude_entries     gratitude_entries[]
  journals              Journal[]
  manifestation_entries manifestation_entries[]
  movie_entries         movie_entries[]
  reading_entries       reading_entries[]
  scrapbook_pages       ScrapbookPage[]
  sessions              Session[]
  subscription          Subscription?
  template_progress     TemplateProgress[]
  tracker_entries       tracker_entries[]
  transactions          Transaction[]
  achievements          UserAchievement[]
  challenges            UserChallenge[]
  notifications         UserNotification[]
  premium_packs         UserPremiumPack[]
  statistics            UserStatistics?
  stickers              UserSticker[]
  voice_usage_logs      VoiceUsageLog[]
  wellness_entries      wellness_entries[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Subscription {
  id                                 String    @id @default(cuid())
  user_id                            String    @unique
  stripe_customer_id                 String?   @unique
  stripe_subscription_id             String?   @unique
  status                             String    @default("inactive")
  plan_type                          String    @default("monthly")
  price                              Float     @default(0.00)
  current_period_start               DateTime?
  current_period_end                 DateTime?
  cancel_at_period_end               Boolean   @default(false)
  created_at                         DateTime  @default(now())
  updated_at                         DateTime  @updatedAt
  plan_tier                          String    @default("none")
  magical_companions_enabled         Boolean   @default(false)
  magical_companions_subscription_id String?
  magical_companions_plan_type       String    @default("none")
  magical_companions_status          String    @default("inactive")
  user                               User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Journal {
  id          String   @id @default(cuid())
  user_id     String
  title       String
  content     String
  date        DateTime @default(now())
  mood        String?
  habits      String?
  tags        String?
  is_favorite Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  type        String   @default("personal")
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("journals")
}

model MediaContent {
  id              String   @id @default(cuid())
  title           String
  description     String?
  type            String
  file_url        String
  duration        Int?
  thumbnail       String?
  category        String?
  is_premium      Boolean  @default(true)
  plays_count     Int      @default(0)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  is_downloadable Boolean  @default(false)
  tier            String   @default("standard")

  @@map("media_content")
}

model CommunityPost {
  id          String   @id @default(cuid())
  user_id     String
  content     String
  image_url   String?
  likes_count Int      @default(0)
  is_approved Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("community_posts")
}

model Notification {
  id                 String             @id @default(cuid())
  title              String
  message            String
  type               String
  link               String?
  image_url          String?
  is_global          Boolean            @default(true)
  created_at         DateTime           @default(now())
  user_notifications UserNotification[]

  @@map("notifications")
}

model UserNotification {
  id              String       @id @default(cuid())
  user_id         String
  notification_id String
  is_read         Boolean      @default(false)
  read_at         DateTime?
  created_at      DateTime     @default(now())
  notification    Notification @relation(fields: [notification_id], references: [id], onDelete: Cascade)
  user            User         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, notification_id])
  @@map("user_notifications")
}

model Template {
  id            String             @id @default(cuid())
  name          String             @unique
  description   String?
  category      String
  pdf_url       String
  thumbnail     String?
  is_colorable  Boolean            @default(true)
  tier          String             @default("total")
  order         Int                @default(0)
  created_at    DateTime           @default(now())
  updated_at    DateTime           @updatedAt
  user_progress TemplateProgress[]

  @@map("templates")
}

model TemplateProgress {
  id            String   @id @default(cuid())
  user_id       String
  template_id   String
  drawing_data  String?
  completed     Boolean  @default(false)
  last_accessed DateTime @default(now())
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  template      Template @relation(fields: [template_id], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, template_id])
  @@map("template_progress")
}

model Challenge {
  id              String          @id @default(cuid())
  title           String
  description     String
  duration        Int
  category        String
  icon            String?
  tier            String          @default("total")
  is_active       Boolean         @default(true)
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  user_challenges UserChallenge[]

  @@map("challenges")
}

model UserChallenge {
  id           String    @id @default(cuid())
  user_id      String
  challenge_id String
  started_at   DateTime  @default(now())
  completed_at DateTime?
  current_day  Int       @default(1)
  notes        String?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
  challenge    Challenge @relation(fields: [challenge_id], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, challenge_id])
  @@map("user_challenges")
}

model UserStatistics {
  id                         String   @id @default(cuid())
  user_id                    String   @unique
  total_journal_entries      Int      @default(0)
  total_templates_completed  Int      @default(0)
  total_challenges_completed Int      @default(0)
  active_days                Int      @default(0)
  streak_days                Int      @default(0)
  last_active                DateTime @default(now())
  created_at                 DateTime @default(now())
  updated_at                 DateTime @updatedAt
  user                       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("user_statistics")
}

model Achievement {
  id                String            @id @default(cuid())
  name              String            @unique
  description       String
  icon              String?
  points_reward     Int               @default(0)
  category          String
  requirement       String
  tier              String            @default("all")
  created_at        DateTime          @default(now())
  user_achievements UserAchievement[]

  @@map("achievements")
}

model UserAchievement {
  id             String      @id @default(cuid())
  user_id        String
  achievement_id String
  unlocked_at    DateTime    @default(now())
  is_new         Boolean     @default(true)
  achievement    Achievement @relation(fields: [achievement_id], references: [id], onDelete: Cascade)
  user           User        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, achievement_id])
  @@map("user_achievements")
}

model Sticker {
  id            String        @id @default(cuid())
  name          String
  image_url     String
  category      String
  is_premium    Boolean       @default(false)
  price_points  Int           @default(0)
  price_eur     Float?
  tier          String        @default("all")
  created_at    DateTime      @default(now())
  pack_required String        @default("none")
  user_stickers UserSticker[]

  @@map("stickers")
}

model UserSticker {
  id            String   @id @default(cuid())
  user_id       String
  sticker_id    String
  unlocked_at   DateTime @default(now())
  unlock_method String   @default("free")
  sticker       Sticker  @relation(fields: [sticker_id], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, sticker_id])
  @@map("user_stickers")
}

model ScrapbookPage {
  id            String   @id @default(cuid())
  user_id       String
  title         String?
  description   String?
  canvas_data   String
  thumbnail     String?
  is_favorite   Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  is_secret     Boolean  @default(false)
  mood          String   @default("light")
  page_type     String   @default("normal")
  private_notes String?
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("scrapbook_pages")
}

model UserPremiumPack {
  id           String    @id @default(cuid())
  user_id      String
  pack_type    String
  purchased_at DateTime  @default(now())
  expires_at   DateTime?
  is_active    Boolean   @default(true)
  user         User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("user_premium_packs")
}

model ChatMessage {
  id               String   @id @default(cuid())
  user_id          String
  role             String
  content          String
  is_risk_detected Boolean  @default(false)
  risk_level       String?
  created_at       DateTime @default(now())
  emotion_detected String?
  user             User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id, created_at])
  @@map("chat_messages")
}

model ChatConsent {
  id          String    @id @default(cuid())
  user_id     String    @unique
  accepted    Boolean   @default(false)
  accepted_at DateTime?
  ip_address  String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@map("chat_consents")
}

model MagicalCompanionCredits {
  id                     String    @id @default(cuid())
  user_id                String    @unique
  total_credits          Int       @default(0)
  credits_used           Int       @default(0)
  free_messages_today    Int       @default(0)
  free_messages_limit    Int       @default(10)
  last_free_reset        DateTime  @default(now())
  last_message_at        DateTime?
  total_messages         Int       @default(0)
  created_at             DateTime  @default(now())
  updated_at             DateTime  @updatedAt
  last_monthly_reset     DateTime  @default(now())
  monthly_messages_limit Int       @default(100)
  monthly_messages_used  Int       @default(0)
  purchased_credits      Int       @default(0)
  magic_voices_used      Int       @default(0)
  magic_voices_limit     Int       @default(50)
  magic_voices_purchased Int       @default(0)
  last_voices_reset      DateTime  @default(now())

  @@map("magical_companion_credits")
}

model CreditPurchase {
  id                    String    @id @default(cuid())
  user_id               String
  pack_type             String
  credits_amount        Int
  price_eur             Float
  stripe_payment_intent String?   @unique
  stripe_charge_id      String?
  payment_status        String    @default("pending")
  applied_at            DateTime?
  created_at            DateTime  @default(now())
  credits_remaining     Int       @default(0)

  @@index([user_id, created_at])
  @@map("credit_purchases")
}

model Transaction {
  id                    String   @id @default(cuid())
  user_id               String
  type                  String
  amount_eur            Float?
  points_change         Int      @default(0)
  description           String
  stripe_payment_intent String?
  status                String   @default("completed")
  created_at            DateTime @default(now())
  user                  User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Companion {
  id            String                  @id @default(cuid())
  user_id       String
  type          String
  name          String                  @default("Compa√±ero")
  color_theme   String                  @default("default")
  voice_tone    String                  @default("warm")
  personality   String                  @default("empathetic")
  is_active     Boolean                 @default(true)
  position_x    Int                     @default(85)
  position_y    Int                     @default(85)
  created_at    DateTime                @default(now())
  updated_at    DateTime                @updatedAt
  conversations CompanionConversation[]
  memories      CompanionMemory[]
  user          User                    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, type])
  @@map("companions")
}

model CompanionConversation {
  id               String    @id @default(cuid())
  companion_id     String
  user_id          String
  role             String
  content          String
  emotion_detected String?
  risk_detected    Boolean   @default(false)
  risk_level       String?
  context_used     String?
  created_at       DateTime  @default(now())
  companion        Companion @relation(fields: [companion_id], references: [id], onDelete: Cascade)

  @@index([companion_id, created_at])
  @@index([user_id, created_at])
  @@map("companion_conversations")
}

model CompanionMemory {
  id            String    @id @default(cuid())
  companion_id  String
  user_id       String
  memory_type   String
  key           String
  value         String
  importance    Int       @default(5)
  last_accessed DateTime  @default(now())
  access_count  Int       @default(0)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt
  companion     Companion @relation(fields: [companion_id], references: [id], onDelete: Cascade)

  @@unique([companion_id, key])
  @@index([companion_id, memory_type])
  @@index([user_id, memory_type])
  @@map("companion_memories")
}

model CompanionInteraction {
  id               String   @id @default(cuid())
  user_id          String
  interaction_type String
  details          String?
  points_earned    Int      @default(0)
  created_at       DateTime @default(now())

  @@index([user_id, created_at])
  @@map("companion_interactions")
}

model VoiceUsageLog {
  id             String   @id @default(cuid())
  user_id        String
  companion_type String
  text_length    Int
  minutes_used   Float
  provider       String   @default("elevenlabs")
  success        Boolean  @default(true)
  created_at     DateTime @default(now())
  user           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id, created_at])
  @@index([companion_type])
  @@map("voice_usage_logs")
}

model EmotionalVoicePhrase {
  id               String                        @id @default(cuid())
  companion_type   String
  phrase_id        String
  emotion_type     String
  text_content     String
  audio_url        String
  duration_seconds Float
  language         String                        @default("es")
  version          Int                           @default(1)
  is_active        Boolean                       @default(true)
  tone             String?
  metadata         String?
  created_at       DateTime                      @default(now())
  last_updated     DateTime                      @default(now()) @updatedAt
  play_logs        EmotionalVoicePhrasePlayLog[]

  @@unique([companion_type, phrase_id])
  @@index([companion_type, emotion_type, is_active])
  @@map("emotional_voice_phrases")
}

model EmotionalVoicePhrasePlayLog {
  id        String               @id @default(cuid())
  user_id   String
  phrase_id String
  trigger   String
  context   String?
  played_at DateTime             @default(now())
  phrase    EmotionalVoicePhrase @relation(fields: [phrase_id], references: [id], onDelete: Cascade)

  @@index([user_id, played_at])
  @@index([phrase_id, played_at])
  @@map("emotional_voice_phrase_play_logs")
}

model dream_entries {
  id             String    @id
  user_id        String
  title          String
  description    String
  category       String    @default("normal")
  emotions       String?
  symbols        String?
  people         String?
  places         String?
  colors         String?
  intensity      Int
  clarity        Int
  interpretation String?
  tags           String?
  dream_date     DateTime? @default(now()) @db.Timestamp(6)
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  updated_at     DateTime? @default(now()) @db.Timestamp(6)
  users          User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_dream_entries_user_id")
}

model exercise_entries {
  id                String    @id
  user_id           String
  exercise_type     String
  duration          Int
  intensity         String    @default("moderate")
  calories          Int?
  weight            Float?    @db.Real
  body_measurements String?
  personal_records  String?
  mood              String?
  notes             String?
  exercise_date     DateTime? @default(now()) @db.Timestamp(6)
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)
  users             User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_exercise_entries_user_id")
}

model finance_entries {
  id             String    @id
  user_id        String
  entry_type     String
  amount         Float     @db.Real
  category       String
  description    String
  payment_method String?
  is_recurring   Boolean?  @default(false)
  tags           String?
  entry_date     DateTime? @default(now()) @db.Timestamp(6)
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  updated_at     DateTime? @default(now()) @db.Timestamp(6)
  users          User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_finance_entries_user_id")
}

model gratitude_entries {
  id         String    @id
  user_id    String
  items      String
  highlight  String?
  learnings  String?
  tomorrow   String?
  mood       Int
  photos     String?
  entry_date DateTime? @default(now()) @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  users      User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_gratitude_entries_user_id")
}

model manifestation_entries {
  id               String    @id
  user_id          String
  goal             String
  affirmations     String
  visualizations   String?
  actions          String?
  feelings         String?
  gratitude_for_it String?
  progress         Int?      @default(0)
  is_achieved      Boolean?  @default(false)
  achieved_date    DateTime? @db.Timestamp(6)
  entry_date       DateTime? @default(now()) @db.Timestamp(6)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
  users            User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_manifestation_entries_user_id")
}

model movie_entries {
  id           String    @id
  user_id      String
  title        String
  type         String    @default("movie")
  genre        String?
  rating       Int?
  director     String?
  year         Int?
  season       Int?
  episode      Int?
  review       String?
  quotes       String?
  poster_image String?
  watched_with String?
  watched_date DateTime? @db.Timestamp(6)
  notes        String?
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  users        User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_movie_entries_user_id")
}

model reading_entries {
  id          String    @id
  user_id     String
  book_title  String
  author      String
  pages       Int       @default(0)
  total_pages Int?
  rating      Int?
  genre       String?
  status      String    @default("reading")
  review      String?
  quotes      String?
  cover_image String?
  start_date  DateTime? @db.Timestamp(6)
  end_date    DateTime? @db.Timestamp(6)
  notes       String?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  users       User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_reading_entries_user_id")
}

model tracker_entries {
  id           String    @id
  user_id      String
  tracker_name String
  tracker_icon String?
  tracker_type String    @default("monthly")
  legend       String
  cells        String
  notes        String?
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  users        User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_tracker_entries_user_id")
}

model wellness_entries {
  id            String    @id
  user_id       String
  mood          Int
  energy        Int
  sleep_hours   Float     @db.Real
  sleep_quality Int
  water         Int?      @default(0)
  meditation    Int?      @default(0)
  gratitude     String?
  achievements  String?
  challenges    String?
  notes         String?
  entry_date    DateTime? @default(now()) @db.Timestamp(6)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  users         User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_wellness_entries_user_id")
}
